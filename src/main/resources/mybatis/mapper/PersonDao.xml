<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cobcap.wageManager.dao.PersonDao">
    <resultMap id="personMap" type="Person">
        <id column="p_id" property="id"/>
        <result column="p_name" property="name"/>
        <result column="p_sex" property="sex"/>
        <result column="p_age" property="age"/>
        <result column="p_time" property="enterTime"/>
        <result column="p_born" property="born"/>
        <result column="pl_id" property="placeId"/>
        <result column="p_pass" property="pass"/>
    </resultMap>

    <select id="getById" resultMap="personMap">
        select *
        from person
        where p_id = #{id}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into person (p_name, p_sex, p_age, p_time, p_born, p_pass, pl_id)
        values (#{name}, #{sex}, #{age}, #{enterTime}, #{born}, #{pass}, #{placeId})
    </insert>

    <update id="updateById">
        update person
        <set>
            <if test="name != null">p_name = #{name},</if>
            <if test="pass != null">p_pass = #{pass},</if>
            <if test="age != null">p_age = #{age},</if>
            <if test="placeId != null">pl_id = #{placeId},</if>
            <if test="sex != null">p_sex = #{sex},</if>
            <if test="enterTime != null">p_time = #{enterTime},</if>
            <if test="born != null">p_born = #{born},</if>
        </set>
        where p_id = #{id}
    </update>

    <delete id="deleteById">
        delete
        from person
        where p_id = #{id}
    </delete>

    <select id="getPersons" resultMap="personMap">
        select top ${size} *
        from dbo.person
        where p_id not in (
            select top ${offset} p_id
            from dbo.person
        )
    </select>

    <select id="getPersonIdPageNation" resultType="Integer">
        select top ${size} p_id
        from dbo.person
        where p_id not in (
            select top ${offset} p_id
            from dbo.person
        )
    </select>

    <select id="isNameExist" resultType="Boolean">
        select
            case
                when count(*) = 0
                    then 0
                else 1 end
        from person
        where p_name = #{name}
    </select>

    <select id="getAllId" resultType="Integer">
        select p_id
        from person
    </select>

    <select id="getBaseSalaryById" resultType="BigDecimal">
        select pl_salary
        from person,
             place
        where p_id = #{id}
          and person.pl_id = place.pl_id
    </select>

    <select id="getTotalCount" resultType="int">
        select count(*)
        from person
    </select>

    <select id="getNameById" resultType="String">
        select p_name
        from person
        where p_id = #{id}
    </select>

    <select id="getAllIdByPlaceId" resultType="Integer">
        select p_id
        from person
        where dbo.person.pl_id = #{placeId}
    </select>

    <delete id="deleteByDeptId">
        delete
        from person
        where person.pl_id in (select pl_id from place where pl_dept_id = #{id})
    </delete>

    <delete id="deleteByPlaceId">
        delete
        from person
        where pl_id = #{id}
    </delete>

    <select id="getPersonBykw" resultMap="personMap">
        select *
        from person,
             place,
             dept
        where (p_name like '%' + #{kw} + '%'
            or pl_name like '%' + #{kw} + '%'
            or d_name like '%' + #{kw} + '%')
          and person.pl_id = place.pl_id
          and pl_dept_id = d_id
    </select>
</mapper>